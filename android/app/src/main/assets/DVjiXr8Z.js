import{_ as b}from"./CllILh9g.js";import{e as S,Z as x,Y as y,X as I,L,P,i as T,g as m,o as B,$ as C,K as F,a0 as H}from"./CxRIJn2k.js";/* empty css        *//* empty css        *//* empty css        */import{u as U}from"./DOlX9fgN.js";import{u as z}from"./z2VIuxhO.js";import{u as A}from"./D28Hbfvk.js";const X=S({__name:"Login",setup(E){const{t:p}=x(),{login:d}=y(),{showPassword:w}=z(),{getUser:_,insertUser:u}=A(),h=I(),a=L(),l=U(),c=P([{label:"username",value:"test001@gmail.com",name:"username",type:"text",placeholder:"Hints.enter_email",required:!0,message:"Hints.enter_email",autocomplete:"username"},{label:"password",value:"123456",name:"password",type:"password",placeholder:"Hints.enter_password",required:!0,message:"Hints.enter_password",autocomplete:"current-password"}]),f=[{text:"log_in",type:"submit"},{text:"Menu.forget_password",type:"button",action:l.handleShowForgetPassword}],g=async s=>{C("Loading...");const o=s.find(e=>e.name==="username")?.value,t=s.find(e=>e.name==="password")?.value;if(!o||!t)throw new Error("There is no username or password.");const n=await d(o,t);if(!n.user||!n.user.id)throw new Error("Login failed");const r=n.user.id;a.setAuthenticiated(!!r),a.setUser({id:r});const i=await _(r);if(!i){console.error("user profile is null."),console.log("creating user profile...");const e=await u({id:r,email:o,avatar_url:"https://vvbtzvedcvhxibozbryz.supabase.co/storage/v1/object/public/icc_avatar/1765174676551-model01w.png"});e&&await u(e),F("/userCenter");return}if(a.setUser(i),i===null)throw new Error("the user is null.");H(p("Message.login_successfully")),setTimeout(()=>{h.push("/userCenter")},2e3)},v=s=>{w(c,s)};return(s,o)=>{const t=b;return B(),T(t,{fieldItems:m(c),buttonItems:f,onSubmit:g,onButton:m(l).handleShowForgetPassword,onPasswordToggle:v},null,8,["fieldItems","onButton"])}}});export{X as _};
