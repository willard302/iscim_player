import{l as _,ap as V,V as he,D as W,e as L,af as F,ah as U,n as R,r as M,p as ge,f as w,ay as se,S as X,az as be,v as ce,b as O,z as Z,ak as ee,a8 as j,m as K,aA as re,aB as Te,J as z,a5 as Oe,aj as te,ai as pe,a9 as ye,aC as Se,ac as ne,x as G,E as ue,aD as Ee}from"./CxRIJn2k.js";const[ke,C,oe]=_("picker"),de=e=>e.find(l=>!l.disabled)||e[0];function Pe(e,l){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(l.children in n)return"cascade"}return"default"}function Y(e,l){l=W(l,0,e.length);for(let n=l;n<e.length;n++)if(!e[n].disabled)return n;for(let n=l-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const ae=(e,l,n)=>l!==void 0&&e.some(c=>c[n.value]===l);function Q(e,l,n){const c=e.findIndex(v=>v[n.value]===l),i=Y(e,c);return e[i]}function Ce(e,l,n){const c=[];let i={[l.children]:e},v=0;for(;i&&i[l.children];){const p=i[l.children],y=n.value[v];if(i=he(y)?Q(p,y,l):void 0,!i&&p.length){const m=de(p)[l.value];i=Q(p,m,l)}v++,c.push(p)}return c}function we(e){const{transform:l}=window.getComputedStyle(e),n=l.slice(7,l.length-1).split(", ")[5];return Number(n)}function xe(e){return V({text:"text",value:"value",children:"children"},e)}const le=200,ie=300,Be=15,[me,J]=_("picker-column"),fe=Symbol(me);var Ie=L({name:me,props:{value:R,fields:F(Object),options:U(),readonly:Boolean,allowHtml:Boolean,optionHeight:F(Number),swipeDuration:F(R),visibleOptionNum:F(R)},emits:["change","clickOption","scrollInto"],setup(e,{emit:l,slots:n}){let c,i,v,p,y;const m=M(),b=M(),h=M(0),g=M(0),E=ge(),k=()=>e.options.length,x=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,P=s=>{let d=Y(e.options,s);const t=-d*e.optionHeight,a=()=>{d>k()-1&&(d=Y(e.options,s));const u=e.options[d][e.fields.value];u!==e.value&&l("change",u)};c&&t!==h.value?y=a:a(),h.value=t},o=()=>e.readonly||!e.options.length,r=s=>{c||o()||(y=null,g.value=le,P(s),l("clickOption",e.options[s]))},f=s=>W(Math.round(-s/e.optionHeight),0,k()-1),T=w(()=>f(h.value)),S=(s,d)=>{const t=Math.abs(s/d);s=h.value+t/.003*(s<0?-1:1);const a=f(s);g.value=+e.swipeDuration,P(a)},B=()=>{c=!1,g.value=0,y&&(y(),y=null)},D=s=>{if(!o()){if(E.start(s),c){const d=we(b.value);h.value=Math.min(0,d-x())}g.value=0,i=h.value,v=Date.now(),p=i,y=null}},I=s=>{if(o())return;E.move(s),E.isVertical()&&(c=!0,Z(s,!0));const d=W(i+E.deltaY.value,-(k()*e.optionHeight),e.optionHeight),t=f(d);t!==T.value&&l("scrollInto",e.options[t]),h.value=d;const a=Date.now();a-v>ie&&(v=a,p=d)},H=()=>{if(o())return;const s=h.value-p,d=Date.now()-v;if(d<ie&&Math.abs(s)>Be){S(s,d);return}const a=f(h.value);g.value=le,P(a),setTimeout(()=>{c=!1},0)},$=()=>{const s={height:`${e.optionHeight}px`};return e.options.map((d,t)=>{const a=d[e.fields.text],{disabled:u}=d,A=d[e.fields.value],N={role:"button",style:s,tabindex:u?-1:0,class:[J("item",{disabled:u,selected:A===e.value}),d.className],onClick:()=>r(t)},ve={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:a};return O("li",N,[n.option?n.option(d,t):O("div",ve,null)])})};return se(fe),X({stopMomentum:B}),be(()=>{const s=c?Math.floor(-h.value/e.optionHeight):e.options.findIndex(a=>a[e.fields.value]===e.value),d=Y(e.options,s),t=-d*e.optionHeight;c&&d<s&&B(),h.value=t}),ce("touchmove",I,{target:m}),()=>O("div",{ref:m,class:J(),onTouchstartPassive:D,onTouchend:H,onTouchcancel:H},[O("ul",{ref:b,style:{transform:`translate3d(0, ${h.value+x()}px, 0)`,transitionDuration:`${g.value}ms`,transitionProperty:g.value?"all":"none"},class:J("wrapper"),onTransitionend:B},[$()])])}});const[Me]=_("picker-toolbar"),q={title:String,cancelButtonText:String,confirmButtonText:String},Ve=["cancel","confirm","title","toolbar"],De=Object.keys(q);var He=L({name:Me,props:q,emits:["confirm","cancel"],setup(e,{emit:l,slots:n}){const c=()=>{if(n.title)return n.title();if(e.title)return O("div",{class:[C("title"),"van-ellipsis"]},[e.title])},i=()=>l("cancel"),v=()=>l("confirm"),p=()=>{var m;const b=(m=e.cancelButtonText)!=null?m:oe("cancel");if(!(!n.cancel&&!b))return O("button",{type:"button",class:[C("cancel"),ee],onClick:i},[n.cancel?n.cancel():b])},y=()=>{var m;const b=(m=e.confirmButtonText)!=null?m:oe("confirm");if(!(!n.confirm&&!b))return O("button",{type:"button",class:[C("confirm"),ee],onClick:v},[n.confirm?n.confirm():b])};return()=>O("div",{class:C("toolbar")},[n.toolbar?n.toolbar():[p(),c(),y()]])}});const[Ne]=_("picker-group"),_e=Symbol(Ne);V({tabs:U(),activeTab:K(0),nextStepText:String,showToolbar:j},q);const $e=V({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:K(44),showToolbar:j,swipeDuration:K(1e3),visibleOptionNum:K(6)},q),Ae=V({},$e,{columns:U(),modelValue:U(),toolbarPosition:ye("top"),columnsFieldNames:Object});var Fe=L({name:ke,props:Ae,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:l,slots:n}){const c=M(),i=M(e.modelValue.slice(0)),{parent:v}=se(_e),{children:p,linkChildren:y}=re(fe);y();const m=w(()=>xe(e.columnsFieldNames)),b=w(()=>Te(e.optionHeight)),h=w(()=>Pe(e.columns,m.value)),g=w(()=>{const{columns:t}=e;switch(h.value){case"multiple":return t;case"cascade":return Ce(t,m.value,i);default:return[t]}}),E=w(()=>g.value.some(t=>t.length)),k=w(()=>g.value.map((t,a)=>Q(t,i.value[a],m.value))),x=w(()=>g.value.map((t,a)=>t.findIndex(u=>u[m.value.value]===i.value[a]))),P=(t,a)=>{if(i.value[t]!==a){const u=i.value.slice(0);u[t]=a,i.value=u}},o=()=>({selectedValues:i.value.slice(0),selectedOptions:k.value,selectedIndexes:x.value}),r=(t,a)=>{P(a,t),h.value==="cascade"&&i.value.forEach((u,A)=>{const N=g.value[A];ae(N,u,m.value)||P(A,N.length?N[0][m.value.value]:void 0)}),ne(()=>{l("change",V({columnIndex:a},o()))})},f=(t,a)=>{const u={columnIndex:a,currentOption:t};l("clickOption",V(o(),u)),l("scrollInto",u)},T=()=>{p.forEach(a=>a.stopMomentum());const t=o();return ne(()=>{const a=o();l("confirm",a)}),t},S=()=>l("cancel",o()),B=()=>g.value.map((t,a)=>O(Ie,{value:i.value[a],fields:m.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:b.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:u=>r(u,a),onClickOption:u=>f(u,a),onScrollInto:u=>{l("scrollInto",{currentOption:u,columnIndex:a})}},{option:n.option})),D=t=>{if(E.value){const a={height:`${b.value}px`},u={backgroundSize:`100% ${(t-b.value)/2}px`};return[O("div",{class:C("mask"),style:u},null),O("div",{class:[Se,C("frame")],style:a},null)]}},I=()=>{const t=b.value*+e.visibleOptionNum,a={height:`${t}px`};return!e.loading&&!E.value&&n.empty?n.empty():O("div",{ref:c,class:C("columns"),style:a},[B(),D(t)])},H=()=>{if(e.showToolbar&&!v)return O(He,pe(te(e,De),{onConfirm:T,onCancel:S}),te(n,Ve))},$=t=>{t.forEach((a,u)=>{a.length&&!ae(a,i.value[u],m.value)&&P(u,de(a)[m.value.value])})};z(g,t=>$(t),{immediate:!0});let s;return z(()=>e.modelValue,t=>{!G(t,i.value)&&!G(t,s)&&(i.value=t.slice(0),s=t.slice(0)),e.modelValue.length===0&&$(g.value)},{deep:!0}),z(i,t=>{G(t,e.modelValue)||(s=t.slice(0),l("update:modelValue",s))},{immediate:!0}),ce("touchmove",Z,{target:c}),X({confirm:T,getSelectedOptions:()=>k.value}),()=>{var t,a;return O("div",{class:C()},[e.toolbarPosition==="top"?H():null,e.loading?O(Oe,{class:C("loading")},null):null,(t=n["columns-top"])==null?void 0:t.call(n),I(),(a=n["columns-bottom"])==null?void 0:a.call(n),e.toolbarPosition==="bottom"?H():null])}}});const Le=ue(Fe),[Re,Ke]=_("form"),Ye={colon:Boolean,disabled:Boolean,readonly:Boolean,required:[Boolean,String],showError:Boolean,labelWidth:R,labelAlign:String,inputAlign:String,scrollToError:Boolean,scrollToErrorPosition:String,validateFirst:Boolean,submitOnEnter:j,showErrorMessage:j,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var Ue=L({name:Re,props:Ye,emits:["submit","failed"],setup(e,{emit:l,slots:n}){const{children:c,linkChildren:i}=re(Ee),v=o=>o?c.filter(r=>o.includes(r.name)):c,p=o=>new Promise((r,f)=>{const T=[];v(o).reduce((B,D)=>B.then(()=>{if(!T.length)return D.validate().then(I=>{I&&T.push(I)})}),Promise.resolve()).then(()=>{T.length?f(T):r()})}),y=o=>new Promise((r,f)=>{const T=v(o);Promise.all(T.map(S=>S.validate())).then(S=>{S=S.filter(Boolean),S.length?f(S):r()})}),m=o=>{const r=c.find(f=>f.name===o);return r?new Promise((f,T)=>{r.validate().then(S=>{S?T(S):f()})}):Promise.reject()},b=o=>typeof o=="string"?m(o):e.validateFirst?p(o):y(o),h=o=>{typeof o=="string"&&(o=[o]),v(o).forEach(f=>{f.resetValidation()})},g=()=>c.reduce((o,r)=>(o[r.name]=r.getValidationStatus(),o),{}),E=(o,r)=>{c.some(f=>f.name===o?(f.$el.scrollIntoView(r),!0):!1)},k=()=>c.reduce((o,r)=>(r.name!==void 0&&(o[r.name]=r.formValue.value),o),{}),x=()=>{const o=k();b().then(()=>l("submit",o)).catch(r=>{l("failed",{values:o,errors:r});const{scrollToError:f,scrollToErrorPosition:T}=e;f&&r[0].name&&E(r[0].name,T?{block:T}:void 0)})},P=o=>{Z(o),x()};return i({props:e}),X({submit:x,validate:b,getValues:k,scrollToField:E,resetValidation:h,getValidationStatus:g}),()=>{var o;return O("form",{class:Ke(),onSubmit:P},[(o=n.default)==null?void 0:o.call(n)])}}});const qe=ue(Ue);export{qe as F,Le as P};
