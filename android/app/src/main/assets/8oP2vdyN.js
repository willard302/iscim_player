import{a1 as g}from"./CxRIJn2k.js";/* empty css        *//* empty css        *//* empty css        */import{u as y,a as v}from"./CGhLo2dv.js";import{u as h}from"./z2VIuxhO.js";let u=null;const P=()=>({getAudio:()=>typeof window>"u"?null:(u||(u=new Audio,u.preload="auto",u.crossOrigin="anonymous"),u),destroyAudio:()=>{u&&(u.pause(),u.src="",u=null)}}),V=()=>{const{formatTime:i}=h(),{getAudio:s}=P(),t=y(),o=v(),f=()=>{const e=s();e&&(e.ontimeupdate=null,e.onended=null,e.onloadedmetadata=null,e.onerror=null,e.ontimeupdate=()=>{if(t.isDragging)return;const n=e.currentTime;o.currentSec=n,o.currentTime=i(n),e.duration&&(t.slidePercent=n/e.duration*100)},e.onloadedmetadata=()=>{const n=e.duration;o.duration=n,o.duraTime=i(n),e.volume=o.volume_on?o.volume/100:0,o.isPlaying&&e.play().catch(r=>console.warn("Auto-play blocked:",r))},e.onended=()=>{const n=o.index>=t.queue.length-1;switch(o.loop){case"normal":n?o.isPlaying=!1:d();break;case"repeatOne":a(o.index);break;case"repeatAll":d();break}},e.onerror=n=>{console.error("Audio Playback Error",n),o.isPlaying=!1})},l=e=>{if(e<0||e>=t.queue.length)return!1;const n=t.queue[e];if(!n)return;o.index=e,o.src=n.src,t.name=n.name;const r=s();return r?(r.src=n.src,r.load(),!0):!1},c=async()=>{const e=s();if(e){!e.src&&t.queue.length>0&&l(0);try{await e.play(),o.isPlaying=!0}catch(n){console.warn("Autoplay revented or load error: ",n),o.isPlaying=!1,g("無法播放音訊")}}},m=()=>{const e=s();e&&(e.pause(),o.isPlaying=!1)},p=()=>{o.isPlaying?m():c()},a=e=>{l(e)&&c()},d=()=>{if(!t.queue.length)return;const e=(o.index+1)%t.queue.length;a(e)};return{initListeners:f,playMusic:c,pauseMusic:m,togglePlay:p,playIndex:a,next:d,prev:()=>{if(!t.queue.length)return;const e=(o.index-1+t.queue.length)%t.queue.length;a(e)},setVolume:e=>{const n=s(),r=Math.max(0,Math.min(100,e));o.volume=r,n&&o.volume_on&&(n.volume=r/100),r>0&&(o.volume_on=!0)},openVolume:()=>{const e=s();if(o.volume_on=!o.volume_on,!e)return;const n=o.volume_on?100:0;o.volume=n,e.volume=n/100},seek:e=>{const n=s();if(!n||!isFinite(n.duration))return;const r=e/100*n.duration;n.currentTime=r,o.currentTime=i(r)},setSourceByIndex:l}};export{V as u};
